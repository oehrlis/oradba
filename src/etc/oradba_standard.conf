#!/usr/bin/env bash
# ------------------------------------------------------------------------------
# OraDBA - Oracle Database Administration Toolset (https://www.oradba.ch)
# ------------------------------------------------------------------------------
# Name.......: oradba_standard.conf
# Author.....: Stefan Oehrli (oes) stefan.oehrli@oradba.ch
# Editor.....: Stefan Oehrli
# Date.......: 2025.12.16
# Revision...: 0.5.0
# Purpose....: Standard environment variables and simple aliases for OraDBA
# Notes......: Loaded after oradba_core.conf. Override in oradba_customer.conf
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# Standard Oracle Environment Variables
# ------------------------------------------------------------------------------

# Default Oracle base directory
ORACLE_BASE="${ORACLE_BASE:-/u01/app/oracle}"

# Default TNS_ADMIN (will be set to ORACLE_HOME/network/admin if not specified)
TNS_ADMIN="${TNS_ADMIN:-}"

# NLS settings
NLS_LANG="${NLS_LANG:-AMERICAN_AMERICA.AL32UTF8}"
NLS_DATE_FORMAT="${NLS_DATE_FORMAT:-YYYY-MM-DD HH24:MI:SS}"
NLS_TIMESTAMP_FORMAT="${NLS_TIMESTAMP_FORMAT:-YYYY-MM-DD HH24:MI:SS.FF}"

# SQL*Plus settings
SQLPATH="${SQLPATH:-${ORADBA_PREFIX}/sql}"
ORACLE_PATH="${ORACLE_PATH:-${ORADBA_PREFIX}/sql}"

# rlwrap (readline wrapper for SQL*Plus)
RLWRAP_COMMAND="${RLWRAP_COMMAND:-rlwrap}"
RLWRAP_OPTS="${RLWRAP_OPTS:--i -c -f $ORACLE_HOME/bin/sqlplus}"

# TWO_TASK for remote connections
ORADBA_TWO_TASK="${ORADBA_TWO_TASK:-}"

# Admin and diagnostic directories (SID-specific, set in sid configs)
ORADBA_ORA_ADMIN_SID="${ORADBA_ORA_ADMIN_SID:-}"
ORADBA_ORA_DIAG_SID="${ORADBA_ORA_DIAG_SID:-}"

# ------------------------------------------------------------------------------
# Simple Aliases (Oracle Tools)
# ------------------------------------------------------------------------------

# SQL*Plus aliases
alias sq='sqlplus / as sysdba'
alias sqh='sqlplus /nolog'
alias sqlp='sqlplus / as sysoper'
alias sqls='sqlplus / as sysdba'

# RMAN alias
alias rmans='rman target /'
alias rman='rman target /'

# Listener alias
alias lsnr='lsnrctl'

# ------------------------------------------------------------------------------
# Simple Aliases (Utilities)
# ------------------------------------------------------------------------------

# Basic shell utilities
alias c='clear'
alias m='more'
alias l='ls -al'
alias ll='ls -alb'
alias lr='ls -ltr'
alias lsl='ls -lrt | tail -n 20'

# Grep utilities
alias psg='${ORADBA_PS} | grep -v " grep " | grep'
alias alig='alias | grep -i'

# ------------------------------------------------------------------------------
# Simple Aliases (Directory Navigation)
# ------------------------------------------------------------------------------

# OraDBA directories
alias cdob='cd ${ORACLE_BASE}'
alias cdoh='cd ${ORACLE_HOME}'
alias cdbn='cd ${ORACLE_HOME}/bin'
alias cdnw='cd ${TNS_ADMIN:-${ORACLE_HOME}/network/admin}'

# ------------------------------------------------------------------------------
# Simple Aliases (Database Operations)
# ------------------------------------------------------------------------------

# Listener and database status
alias lstat='lsnrctl status'
alias lstart='lsnrctl start'
alias lstop='lsnrctl stop'
alias pmon='ps -ef | grep pmon'

# Configuration files
alias oratab='cat ${ORATAB_FILE:-/etc/oratab}'
alias tns='cat ${TNS_ADMIN:-${ORACLE_HOME}/network/admin}/tnsnames.ora'

# ------------------------------------------------------------------------------
# Simple Aliases (Editor Shortcuts)
# ------------------------------------------------------------------------------

# Edit common Oracle files
alias vio='vi ${ORATAB_FILE}'
alias vit='vi ${TNS_ADMIN}/tnsnames.ora'
alias vil='vi ${TNS_ADMIN}/listener.ora'
alias visql='vi ${TNS_ADMIN}/sqlnet.ora'
alias vildap='vi ${TNS_ADMIN}/ldap.ora'

# Edit OraDBA configuration files
alias vis='vi ${ORADBA_CONFIG_DIR}/sid.${ORACLE_SID}.conf'
alias vic='vi ${ORADBA_CONFIG_DIR}/oradba_customer.conf'

# ------------------------------------------------------------------------------
# Simple Aliases (Additional Directory Navigation)
# ------------------------------------------------------------------------------

# OraDBA subdirectories
alias cdb='cd ${ORADBA_PREFIX}'
alias cde='cd $(dirname ${ORATAB_FILE})'
alias cdr='cd ${ORACLE_HOME}/rdbms/admin'
alias cdt='cd ${TNS_ADMIN}'
alias cdn='cd ${TNS_ADMIN}/..'

# Log and temp directories
alias cdlog='cd ${ORADBA_LOG}'
alias cdtmp='cd ${ORADBA_TEMP}'

# ------------------------------------------------------------------------------
# Simple Aliases (Miscellaneous)
# ------------------------------------------------------------------------------

# Database status
alias sta='${ORADBA_PREFIX}/bin/dbstatus.sh'

# Save crontab
alias save_cron='crontab -l > $HOME/crontab.txt.$(date +%Y-%m-%d_%H:%M:%S)'

# ------------------------------------------------------------------------------
# Dynamic Aliases (Set by SID configuration)
# ------------------------------------------------------------------------------

# These aliases are defined here but use variables set in SID-specific configs
# They will work once ORADBA_ORA_ADMIN_SID and ORADBA_ORA_DIAG_SID are set

if [[ -n "${ORADBA_ORA_ADMIN_SID}" ]]; then
    alias cda='cd ${ORADBA_ORA_ADMIN_SID}'
    alias cdc='cd ${ORADBA_ORA_ADMIN_SID}/create'
    alias vii='vi ${ORADBA_ORA_ADMIN_SID}/pfile/init${ORACLE_SID}.ora'
fi

if [[ -n "${ORADBA_ORA_DIAG_SID}" ]]; then
    alias cdd='cd ${ORADBA_ORA_DIAG_SID}'
fi

# ------------------------------------------------------------------------------
# Load Dynamic Aliases and Functions
# ------------------------------------------------------------------------------

# Source aliases.sh for dynamic alias generation if aliases are enabled
if [[ "${ORADBA_LOAD_ALIASES}" == "true" ]]; then
    if [[ -f "${ORADBA_PREFIX}/lib/aliases.sh" ]]; then
        # shellcheck source=/dev/null
        source "${ORADBA_PREFIX}/lib/aliases.sh"
    fi
fi

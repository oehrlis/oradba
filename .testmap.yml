# ------------------------------------------------------------------------------
# OraDBA Test Mapping Configuration (v0.20.0)
# ------------------------------------------------------------------------------
# Defines which test files should run when specific source files change.
# Used by scripts/select_tests.sh for smart test selection.
#
# Architecture: Registry API + Plugin System + Environment Builder
# Test Coverage: 1516 tests across 65 test files
# ------------------------------------------------------------------------------

# Tests that always run regardless of changes (core functionality)
always_run:
  - test_installer.bats
  - test_oradba_version.bats
  - test_oraenv.bats
  - test_registry.bats
  - test_plugin_interface.bats
  - test_plugin_return_values.bats

# Mapping: source file/pattern -> test files
# When a source file changes, run the associated tests
mappings:
  # Core libraries - affect multiple tests
  src/lib/oradba_common.sh:
    - test_oradba_common.bats
    - test_oradba_aliases.bats
    - test_oradba_db_functions.bats
    - test_oradba_env_config.bats
    - test_oradba_env_status.bats
    - test_oraenv.bats
    - test_oradba_check.bats
    - test_service_management.bats
    - test_sid_config.bats
    - test_logging.bats
    - test_logging_infrastructure.bats
    - test_execute_db_query.bats
    - test_registry.bats
    - test_plugin_debug.bats
    - test_plugin_isolation.bats
  
  src/lib/oradba_aliases.sh:
    - test_oradba_aliases.bats
  
  src/lib/oradba_db_functions.sh:
    - test_oradba_db_functions.bats
    - test_oraenv.bats
    - test_execute_db_query.bats
  
  src/lib/extensions.sh:
    - test_extensions.bats
    - test_oradba_common.bats
  
  # Registry API - unified installation management
  src/lib/oradba_registry.sh:
    - test_registry.bats
    - test_oradba_env_parser.bats
    - test_oradba_env_status.bats
    - test_oracle_homes.bats
    - test_oradba_homes.bats
    - test_oratab_priority.bats
  
  # Binaries - direct mapping
  src/bin/oradba_check.sh:
    - test_oradba_check.bats
  
  src/bin/oradba_version.sh:
    - test_oradba_version.bats
  
  src/bin/oradba_help.sh:
    - test_oradba_help.bats
  
  src/bin/oradba_env.sh:
    - test_oradba_env_parser.bats
    - test_oradba_env_status.bats
    - test_registry.bats
  
  src/bin/oraenv.sh:
    - test_oraenv.bats
  
  src/bin/oraup.sh:
    - test_oraup.bats
  
  src/bin/dbstatus.sh:
    - test_oradba_db_functions.bats
  
  src/bin/oradba_sqlnet.sh:
    - test_oradba_sqlnet.bats
  
  src/bin/oradba_extension.sh:
    - test_extensions.bats
  
  src/bin/oradba_rman.sh:
    - test_oradba_rman.bats
  
  src/bin/oradba_homes.sh:
    - test_oradba_homes.bats
    - test_oracle_homes.bats
    - test_registry.bats
  
  src/bin/oradba_dbca.sh:
    - test_oradba_dbca.bats
  
  src/bin/oradba_dsctl.sh:
    - test_oradba_dsctl.bats
  
  # Environment Management Libraries (v0.19.0 architecture)
  src/lib/oradba_env_parser.sh:
    - test_oradba_env_parser.bats
    - test_oradba_env_parser_unit.bats
    - test_registry.bats
    - test_oracle_homes.bats
  
  src/lib/oradba_env_builder.sh:
    - test_client_path_config.bats
    - test_oradba_env_status.bats
    - test_oradba_env_builder_unit.bats
  
  src/lib/oradba_env_config.sh:
    - test_oradba_env_config.bats
    - test_oradba_env_parser.bats
  
  src/lib/oradba_env_validator.sh:
    - test_oradba_check.bats
    - test_oracle_homes.bats
    - test_oradba_env_validator_unit.bats
  
  src/lib/oradba_env_status.sh:
    - test_oradba_env_status.bats
  
  src/lib/oradba_env_changes.sh:
    - test_oradba_env_changes.bats
  
  # Plugin system (9 plugins) - affects status checks and environment building
  src/lib/plugins/plugin_interface.sh:
    - test_plugin_interface.bats
    - test_plugin_isolation.bats
    - test_plugin_return_values.bats
    - test_plugin_return_values_real.bats
    - test_database_plugin.bats
    - test_client_plugin.bats
    - test_iclient_plugin.bats
    - test_datasafe_plugin.bats
    - test_oud_plugin.bats
    - test_java_plugin.bats
    - test_oradba_env_status.bats
  
  src/lib/plugins/database_plugin.sh:
    - test_database_plugin.bats
    - test_plugin_interface.bats
    - test_plugin_isolation.bats
    - test_plugin_return_values.bats
    - test_plugin_return_values_real.bats
    - test_oradba_env_status.bats
  
  src/lib/plugins/datasafe_plugin.sh:
    - test_datasafe_plugin.bats
    - test_plugin_interface.bats
    - test_plugin_isolation.bats
    - test_plugin_return_values.bats
    - test_plugin_return_values_real.bats
    - test_oradba_env_status.bats
  
  src/lib/plugins/client_plugin.sh:
    - test_client_plugin.bats
    - test_plugin_interface.bats
    - test_plugin_isolation.bats
    - test_plugin_return_values.bats
    - test_plugin_return_values_real.bats
    - test_client_path_config.bats
    - test_oradba_env_status.bats
  
  src/lib/plugins/iclient_plugin.sh:
    - test_iclient_plugin.bats
    - test_plugin_interface.bats
    - test_plugin_isolation.bats
    - test_plugin_return_values.bats
    - test_plugin_return_values_real.bats
    - test_client_path_config.bats
    - test_oradba_env_status.bats
  
  src/lib/plugins/oud_plugin.sh:
    - test_oud_plugin.bats
    - test_plugin_interface.bats
    - test_plugin_isolation.bats
    - test_plugin_return_values.bats
    - test_plugin_return_values_real.bats
    - test_oradba_env_status.bats
  
  src/lib/plugins/java_plugin.sh:
    - test_java_plugin.bats
    - test_plugin_interface.bats
    - test_plugin_isolation.bats
    - test_plugin_return_values.bats
    - test_plugin_return_values_real.bats
    - test_java_path_config.bats
    - test_oradba_env_status.bats
  
  src/lib/plugins/weblogic_plugin.sh:
    - test_plugin_interface.bats
    - test_oradba_env_status.bats
  
  src/lib/plugins/oms_plugin.sh:
    - test_plugin_interface.bats
    - test_oradba_env_status.bats
  
  src/lib/plugins/emagent_plugin.sh:
    - test_plugin_interface.bats
    - test_oradba_env_status.bats
  
  # Service management scripts
  src/bin/oradba_dbctl.sh:
    - test_service_management.bats
  
  src/bin/oradba_lsnrctl.sh:
    - test_service_management.bats
  
  src/bin/oradba_services.sh:
    - test_service_management.bats
  
  src/bin/oradba_services_root.sh:
    - test_service_management.bats
  
  src/etc/oradba_services.conf:
    - test_service_management.bats
  
  # Job wrapper scripts
  src/bin/rman_jobs.sh:
    - test_job_wrappers.bats
  
  src/bin/exp_jobs.sh:
    - test_job_wrappers.bats
  
  src/bin/imp_jobs.sh:
    - test_job_wrappers.bats
  
  src/bin/longops.sh:
    - test_longops.bats
    - test_job_wrappers.bats
  
  src/bin/get_seps_pwd.sh:
    - test_get_seps_pwd.bats
  
  # Sync scripts
  src/bin/sync_from_peers.sh:
    - test_sync_scripts.bats
  
  src/bin/sync_to_peers.sh:
    - test_sync_scripts.bats
  
  # Configuration files
  src/etc/oradba_core.conf:
    - test_oradba_common.bats
    - test_oradba_env_config.bats
  
  src/etc/oradba_standard.conf:
    - test_oradba_aliases.bats
    - test_oradba_common.bats
    - test_oradba_env_config.bats
  
  src/etc/oradba_homes.conf:
    - test_oracle_homes.bats
    - test_oradba_homes.bats
    - test_registry.bats
  
  src/etc/oradba_services.conf:
    - test_service_management.bats
  
  src/etc/sid.ORCL.conf.example:
    - test_sid_config.bats
    - manual/test_sid_variable_isolation.sh
  
  # Templates for SID configuration
  src/templates/etc/sid.ORACLE_SID.conf.example:
    - test_sid_config.bats
    - manual/test_sid_variable_isolation.sh
  
  # RMAN configuration
  src/rcv/*.rman:
    - test_oradba_rman.bats
  
  # Installer changes
  scripts/build_installer.sh:
    - test_installer.bats
  
  src/bin/oradba_install.sh:
    - test_installer.bats

# Pattern-based mappings (regex)
# If source file matches pattern, run associated tests
patterns:
  # Any test file change runs itself
  - pattern: "^tests/test_(.+)\\.bats$"
    tests:
      - "test_$1.bats"
  
  # Documentation changes don't require tests
  - pattern: "^(doc|src/doc)/.*\\.md$"
    tests: []
  
  # SQL scripts don't have dedicated tests yet
  - pattern: "^src/sql/.*\\.sql$"
    tests: []
  
  # RMAN scripts don't have dedicated tests yet
  - pattern: "^src/rcv/.*\\.rman$"
    tests: []
  
  # Template changes might affect installer
  - pattern: "^src/templates/"
    tests:
      - test_service_management.bats
  
  # Makefile changes might affect build
  - pattern: "^Makefile$"
    tests:
      - test_installer.bats
  
  # VERSION file changes
  - pattern: "^VERSION$"
    tests:
      - test_installer.bats
      - test_oradba_version.bats

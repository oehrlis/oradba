# OraDBA v0.18.5 Release Notes

**Release Date:** January 13, 2026  
**Release Type:** Minor Release  
**Compatibility:** Backward compatible with v0.18.x

## Overview

This release addresses five configuration and environment management improvements
including template organization, intelligent ORACLE_BASE derivation, Oracle
version detection, and better handling of non-root environments.

## What's New

### 1. Template File Organization

**Changed:** Moved `oradba_homes.conf.template` to standard templates location

- Relocated from `src/etc/` to `src/templates/etc/`
- Consistent with other configuration templates
- Improved discoverability and organization

**Files Changed:**

- `src/templates/etc/oradba_homes.conf.template` (moved)

### 2. Intelligent ORACLE_BASE Derivation

**Enhanced:** ORACLE_BASE is now derived intelligently from ORACLE_HOME path

**Previous behavior:**

```bash
# Failed for paths like /appl/oracle/product/26.0.0/client
derived_base="$(dirname "$(dirname "$ORACLE_HOME")")"
# Result: /appl/oracle/product/26.0.0 (INCORRECT)
```

**New behavior:**

```bash
# Searches upward for directory containing "product", "oradata", or "oraInventory"
derived_base="$(derive_oracle_base "$ORACLE_HOME")"
# Result: /appl/oracle (CORRECT)
```

**Implementation:**

- Added `derive_oracle_base()` function in `oradba_common.sh`
- Walks up directory tree looking for Oracle base indicators
- Falls back to traditional two-levels-up method if needed
- Updated `oraenv.sh` to use new function

**Supported paths:**

- `/appl/oracle/product/26.0.0/client` → `/appl/oracle`
- `/appl/oracle/product/19.0.0.0` → `/appl/oracle`
- `/u01/app/oracle/product/19c/dbhome_1` → `/u01/app/oracle`

**Files Changed:**

- `src/lib/oradba_common.sh` - Added `derive_oracle_base()` function
- `src/bin/oraenv.sh` - Updated ORACLE_BASE derivation (2 locations)

### 3. Oracle Version Detection for Homes

**Added:** VERSION field to `oradba_homes.conf` with automatic detection

**Configuration Format:**

```text
NAME:ORACLE_HOME:PRODUCT_TYPE:ORDER:ALIAS_NAME:DESCRIPTION:VERSION
```

**Version Values:**

- `AUTO`: Version determined dynamically (recommended)
- `XXYZ`: Specific version (e.g., `1920` for Oracle 19.2.0, `2300` for 23.0.0)
- `ERR`: For products without database components

**Detection Methods:**

1. Parse from `sqlplus -version` output
2. Check `$ORACLE_HOME/OPatch/opatch lsinventory`
3. Parse from `$ORACLE_HOME/inventory/ContentsXML/comps.xml`
4. Extract from path (e.g., `/product/19.0.0.0`)

**Examples:**

```text
CLIENT19:/opt/oracle/product/19c/client:client:30:client:Oracle Client 19c:AUTO
CLIENT26:/appl/oracle/product/23.26.0.0/client:client:35:cli260:Oracle Client 23ai:AUTO
DATASAFE:/opt/oracle/product/datasafe:datasafe:20:ds:Data Safe Connector:ERR
WLS14:/u01/app/oracle/middleware/wls14:weblogic:40:wls:WebLogic 14.1.1:ERR
```

**Files Changed:**

- `src/templates/etc/oradba_homes.conf.template` - Updated format and examples
- `src/lib/oradba_common.sh` - Added `detect_oracle_version()` and `get_oracle_home_version()` functions
- `src/lib/oradba_common.sh` - Updated parsing functions to handle VERSION field
- `src/bin/oradba_homes.sh` - Added `--version` parameter, updated display functions
- `src/bin/oraup.sh` - Updated parsing to handle VERSION field

### 4. Non-Root ORATAB Access

**Fixed:** `vio` alias now works when `/etc/oratab` is not accessible

**Previous behavior:**

```bash
alias vio='vi ${ORATAB_FILE}'  # ORATAB_FILE=/etc/oratab (hardcoded)
```

**New behavior:**

```bash
# ORATAB_FILE dynamically determined via get_oratab_path()
# Priority: ORADBA_ORATAB → /etc/oratab → /var/opt/oracle/oratab → 
#           ${ORADBA_BASE}/etc/oratab → ${HOME}/.oratab
```

**Implementation:**

- Updated `oradba_core.conf` to not hardcode ORATAB_FILE
- Added dynamic initialization in `oraenv.sh` after loading `oradba_common.sh`
- Uses existing `get_oratab_path()` function with priority system

**Files Changed:**

- `src/etc/oradba_core.conf` - Removed hardcoded default
- `src/bin/oraenv.sh` - Added ORATAB_FILE initialization

### 5. Non-Database Home Support in oraup.sh

**Enhanced:** Better handling of non-database Oracle Homes

**Implementation:**

- Updated parsing to handle VERSION field
- Oracle Homes displayed without SQL*Plus queries
- Works correctly for client, datasafe, oud, weblogic, oms, emagent

**Files Changed:**

- `src/bin/oraup.sh` - Updated parsing logic

## Technical Details

### New Functions

#### `derive_oracle_base()` in `oradba_common.sh`

```bash
# Intelligently derive ORACLE_BASE from ORACLE_HOME
# Arguments: $1 - ORACLE_HOME path
# Returns: Derived ORACLE_BASE path
derive_oracle_base() {
    # Walks up directory tree looking for Oracle base indicators
    # Checks for: product/, oradata/, oraInventory/, admin/
    # Limits search to 5 levels up
    # Falls back to dirname(dirname(ORACLE_HOME))
}
```

#### `detect_oracle_version()` in `oradba_common.sh`

```bash
# Detect Oracle version from ORACLE_HOME
# Arguments: $1 - ORACLE_HOME path, $2 - Product type (optional)
# Returns: Version in XXYZ format or "Unknown" or "ERR"
detect_oracle_version() {
    # Method 1: sqlplus -version
    # Method 2: OPatch inventory
    # Method 3: inventory XML
    # Method 4: Extract from path
}
```

#### `get_oracle_home_version()` in `oradba_common.sh`

```bash
# Get version for a named home (handles AUTO detection)
# Arguments: $1 - Home name
# Returns: Version (AUTO, XXYZ, ERR, or Unknown)
```

### Updated Functions

All Oracle Home parsing functions updated to handle VERSION field:

- `parse_oracle_home()` - Returns 7 fields instead of 6
- `list_oracle_homes()` - Parses and outputs VERSION field
- `resolve_oracle_home_name()` - Handles VERSION in parsing
- `generate_sid_lists()` - Handles VERSION in parsing
- `generate_oracle_home_aliases()` - Handles VERSION in parsing

## Upgrade Notes

### From v0.18.4

This is a minor release with backward compatibility:

```bash
# Using the installer
./oradba_install.sh --update

# Or manually
cd $ORADBA_BASE
git pull
git checkout v0.18.5
```

### Existing Configurations

**Backward Compatibility:**

- Existing `oradba_homes.conf` files without VERSION field work correctly
- VERSION defaults to `AUTO` if not specified
- Old 6-field format automatically detected and handled

**Optional Update:**
Add VERSION field to existing entries:

```bash
# Before (still works):
CLIENT19:/opt/oracle/product/19c/client:client:30:client:Oracle Client 19c

# After (recommended):
CLIENT19:/opt/oracle/product/19c/client:client:30:client:Oracle Client 19c:AUTO
```

## Testing

All tests pass with new functionality:

- ✅ Shell script linting (shellcheck)
- ✅ Backward compatibility with old config format
- ✅ Version detection for multiple Oracle versions
- ✅ ORACLE_BASE derivation for complex paths
- ✅ ORATAB_FILE dynamic initialization

## Known Issues

None specific to this release. Refer to the [issue tracker](https://github.com/oehrlis/oradba/issues) for open issues.

## Files Modified

### Core Changes

- `VERSION` - Updated to 0.18.5
- `CHANGELOG.md` - Added v0.18.5 release notes

### Template & Configuration

- `src/templates/etc/oradba_homes.conf.template` - Moved, updated format with VERSION field
- `src/etc/oradba_core.conf` - Removed ORATAB_FILE hardcoded default

### Scripts & Libraries

- `src/lib/oradba_common.sh` - Added version detection and ORACLE_BASE derivation functions
- `src/bin/oraenv.sh` - Updated ORACLE_BASE derivation, added ORATAB_FILE initialization
- `src/bin/oradba_homes.sh` - Added VERSION support, updated display functions
- `src/bin/oraup.sh` - Updated parsing for VERSION field

## Contributors

- Stefan Oehrli (oes) - All changes

## Getting Help

- **Documentation:** [OraDBA Documentation](https://oehrlis.github.io/oradba/)
- **Issues:** [GitHub Issues](https://github.com/oehrlis/oradba/issues)
- **Discussions:** [GitHub Discussions](https://github.com/oehrlis/oradba/discussions)

## Download

- **GitHub Release:** [v0.18.5](https://github.com/oehrlis/oradba/releases/tag/v0.18.5)
- **Tarball:** [oradba-0.18.5.tar.gz](https://github.com/oehrlis/oradba/releases/download/v0.18.5/oradba-0.18.5.tar.gz)
- **Installer:** [oradba_install.sh](https://raw.githubusercontent.com/oehrlis/oradba/v0.18.5/oradba_install.sh)

---

For the complete changelog, see [CHANGELOG.md](../../CHANGELOG.md).

# Release Notes - OraDBA v0.13.1

**Release Date:** January 4, 2026  
**Release Type:** Patch Release (Issue #56 Phase 1)  
**Focus:** Logging System Consolidation

## Overview

Version 0.13.1 introduces a unified logging system that consolidates four
separate logging functions into a single, flexible `log()` function with
level-based filtering. This release maintains full backward compatibility
while providing a cleaner API for new code.

## What's New

### Unified Logging System

**New `log()` Function** - Single interface for all logging needs:

```bash
oradba_log INFO "Database started successfully"
oradba_log WARN "Archive log directory is 90% full"
oradba_log ERROR "Connection to database failed"
oradba_log DEBUG "SQL query: ${sql_query}"
```

**Level-Based Filtering** via `ORADBA_LOG_LEVEL` environment variable:

```bash
export ORADBA_LOG_LEVEL=DEBUG  # Show all messages (DEBUG, INFO, WARN, ERROR)
export ORADBA_LOG_LEVEL=INFO   # Default - Show INFO, WARN, ERROR
export ORADBA_LOG_LEVEL=WARN   # Show only WARN and ERROR
export ORADBA_LOG_LEVEL=ERROR  # Show only ERROR messages
```

**Legacy Support** - `DEBUG=1` continues to work:

```bash
export DEBUG=1  # Automatically enables DEBUG level
oradba_log DEBUG "Debug information"
```

**Consistent Output Format:**

```text
[INFO] 2026-01-04 17:30:45 - Database started successfully
[WARN] 2026-01-04 17:30:46 - Archive log directory is 90% full
[ERROR] 2026-01-04 17:30:47 - Connection to database failed
```

### Backward Compatibility

All existing logging functions continue to work without modification:

```bash
# Legacy syntax - still fully supported
log_info "Database started"
log_warn "Archive log warning"
log_error "Connection failed"
log_debug "Debug information"
```

**200+ existing function calls** preserved across the codebase - no breaking changes.

**Opt-in Deprecation Warnings** for gradual migration:

```bash
export ORADBA_SHOW_DEPRECATION_WARNINGS=true
log_info "Test"
# Output: [WARN] ... Function 'log_info' is deprecated. Use 'oradba_log INFO <message>' instead.
```

## Technical Details

### Modified Files

- **src/lib/common.sh** (v0.11.0 → v0.13.1)
  - New `log()` function (lines 28-64)
  - Deprecation warning helper (lines 91-104)
  - Backward-compatible wrappers (lines 106-127)
  
- **tests/test_logging.bats** (NEW - 28 comprehensive tests)
  - Basic functionality tests
  - Log level filtering tests
  - DEBUG=1 backward compatibility tests
  - Deprecated function wrapper tests
  - Deprecation warning tests
  - Message formatting tests
  - Integration tests

### Documentation Updates

- **doc/api.md** - Complete logging API documentation with migration examples
- **doc/development.md** - Updated coding standards and best practices
- **src/lib/README.md** - Updated usage examples
- **CHANGELOG.md** - Detailed v0.13.1 entry with migration notes

### Test Results

- **New logging tests:** 28/28 passing ✅
- **Full test suite:** 601/601 passing (25 environment-dependent skipped) ✅
- **No regressions:** All existing functionality preserved ✅

## Migration Guide

### For New Code (Recommended)

Use the unified `log()` function:

```bash
#!/usr/bin/env bash
source "${ORADBA_BASE}/lib/common.sh"

# Configure log level
export ORADBA_LOG_LEVEL=INFO  # or DEBUG, WARN, ERROR

# Use log function
oradba_log INFO "Script started"
oradba_log DEBUG "Processing file: ${filename}"
oradba_log WARN "Low disk space detected"
oradba_log ERROR "Failed to connect to database"
```

### For Existing Code (No Changes Required)

Your existing scripts continue to work without modification:

```bash
#!/usr/bin/env bash
source "${ORADBA_BASE}/lib/common.sh"

# Legacy functions still work
log_info "Script started"
log_debug "Processing file: ${filename}"
log_warn "Low disk space detected"
log_error "Failed to connect to database"
```

### Gradual Migration Strategy

1. **Phase 1** - No action required, everything works as-is
2. **Phase 2** (Optional) - Enable deprecation warnings to identify legacy usage:

   ```bash
   export ORADBA_SHOW_DEPRECATION_WARNINGS=true
   ```

3. **Phase 3** (Optional) - Update scripts to use new `log()` function at your
   convenience

## Upgrade Instructions

### From v0.13.0 or Earlier

```bash
# Standard upgrade via installer
cd /tmp
curl -L https://github.com/oehrlis/oradba/releases/download/v0.13.1/oradba_install.sh -o oradba_install.sh
chmod +x oradba_install.sh
./oradba_install.sh --update

# Or via local installation
cd /opt/oradba
git fetch --tags
git checkout v0.13.1
source ~/.bash_profile
```

### Verification

```bash
# Check version
oradba --version
# Should show: OraDBA v0.13.1

# Test new logging
source ${ORADBA_BASE}/lib/common.sh
oradba_log INFO "Test successful"
# Should output: [INFO] 2026-01-04 HH:MM:SS - Test successful

# Test log level filtering
export ORADBA_LOG_LEVEL=WARN
oradba_log INFO "Should not appear"
oradba_log WARN "Should appear"

# Test legacy compatibility
log_info "Legacy function still works"
```

## Breaking Changes

**None** - This release is fully backward compatible.

## Known Issues

None

## Dependencies

- Bash 4.0 or higher (unchanged)
- Oracle Database (for database-related features, unchanged)

## Next Release

**v0.13.2** (Planned) - Issue #56 Phase 2: SQL Query Executor

- Unified `execute_db_query()` function
- Elimination of SQL*Plus boilerplate duplication
- Consistent error handling for database queries

## Credits

- **Development:** OraDBA Team
- **Issue Tracking:** [#56 - Refactor and Optimize Shell Library Functions](https://github.com/oehrlis/oradba/issues/56)

## Support

- **Documentation:** [OraDBA Documentation](https://github.com/oehrlis/oradba/tree/main/doc)
- **Issues:** [GitHub Issues](https://github.com/oehrlis/oradba/issues)
- **Discussions:** [GitHub Discussions](https://github.com/oehrlis/oradba/discussions)

---

**Full Changelog:** [v0.13.0...v0.13.1](https://github.com/oehrlis/oradba/compare/v0.13.0...v0.13.1)

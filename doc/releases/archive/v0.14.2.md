# Release Notes - OraDBA v0.14.2

**Release Date:** January 7, 2026  
**Release Type:** Patch Release  
**Focus:** Extension Integrity Improvements

## Overview

Version 0.14.2 is a patch release that improves extension checksum management and
verification. This release standardizes the checksum filename convention, fixes
false positive detection issues, and prevents installation failures due to extension
integrity problems.

## What's Changed

### üîß Extension Checksum Standardization

Standardized extension checksum filename to `.extension.checksum` for simpler
management and better GitHub release integration.

**Previous Behavior:**

- Used `.${extension_name}.checksum` (e.g., `.customer.checksum`)
- Required renaming when distributing extensions
- Extension name extracted from checksum filename

**New Behavior:**

- Uses fixed `.extension.checksum` filename
- No renaming needed - same name in all extensions
- Extension name extracted from directory name
- Automatically included in GitHub releases

**Migration:** Both naming schemes are supported. New extensions created with
`oradba_extension.sh create` will use the new naming convention.

### üîß Extension Verification Improvements

Enhanced how disabled extensions and metadata files are handled during verification.

**Changes:**

1. **Disabled Extensions Skipped**
   - Extensions with `enabled: false` no longer checked
   - Prevents confusing "FAILED" messages for disabled extensions
   - Only enabled extensions appear in verification output

2. **Metadata and Log Files Excluded**
   - `.extension` file excluded from checksum verification
   - `log/` directory excluded from verification
   - Similar to how `.install_info` is handled for core OraDBA
   - Expected to be modified during installation and operation

3. **Improved Checksum Parsing**
   - Uses `awk` to properly parse checksum file format
   - Correctly filters by filename field in `hash filename` pairs
   - Fixes edge cases where line-based filtering failed

**Example Output:**

```text
Installed Extensions:
  customer    v1.0.0     [enabled] ‚úì
  testing     v0.5.0     [disabled]

Extension Integrity Checks:
  ‚úì Extension 'customer': verified (15 files)
```

Note: Disabled `testing` extension not shown in integrity checks.

### üîß Installer Verification Changes

Modified installer to skip extension verification, preventing installation failures
due to extension issues.

**Problem:**

- Installer used `--verify` which checked both core and extensions
- Extension integrity failures caused entire installation to fail
- Users couldn't install/update OraDBA if extensions had issues

**Solution:**

- Added `--verify-core` option to verify only core OraDBA files
- Installer now uses `--verify-core` instead of `--verify`
- Extension verification remains available via `--verify` or `--info`

**Commands:**

```bash
# Verify core installation only (used by installer)
oradba_version.sh --verify-core

# Verify core + extensions (manual verification)
oradba_version.sh --verify

# Show version info with extension status
oradba_version.sh --info
```

## What's Fixed

### üêõ False Positive: OraDBA as Extension

Fixed issue where the main OraDBA installation was incorrectly detected as a failed
extension during integrity checks.

**Problem:**

- `check_extension_checksums()` found `.oradba.checksum` in `ORADBA_BASE`
- OraDBA itself was listed as "Extension 'oradba': FAILED"
- Confusing error message for users

**Root Cause:**

- Function searched for checksum files in both extension directories and
  `ORADBA_LOCAL_BASE`
- When `ORADBA_LOCAL_BASE` was parent of `ORADBA_BASE`, the main checksum was found

**Solution:**

- Added directory exclusion logic using canonical path comparison
- Skips checksum files in `ORADBA_BASE` directory
- Skips checksum files in `ORADBA_BASE/*` (except `/extensions`)
- Handles symlinks properly via `$(cd dir && pwd)` expansion

**Testing:**

```bash
# Before fix
Extension Integrity Checks:
  ‚úó Extension 'oradba': FAILED

# After fix
Extension Integrity Checks:
  ‚úì Extension 'customer': verified (15 files)
```

### üêõ Color Codes Not Rendering

Fixed ANSI escape codes appearing as raw text in extension status output.

**Problem:**

- Extension integrity status showed: `[enabled] \033[0;31m‚úó\033[0m`
- Color codes not interpreted by `printf`

**Solution:**

- Changed from `printf` to `echo -e` for checksum status
- Color indicators now render correctly (‚úì in green, ‚úó in red)

**Example:**

```bash
# Before: Raw escape codes visible
acn    v0.1.0     [enabled] \033[0;31m‚úó\033[0m

# After: Colors render properly
acn    v0.1.0     [enabled] ‚úó  # (shown in red)
```

## New Features

### ‚ú® Verbose Mode for Extension Checks

Added `--verbose` flag to show detailed information about integrity check failures
and additional files.

**Usage:**

```bash
# Compact view (default)
oradba_version.sh --verify
Extension Integrity Checks:
  ‚úó Extension 'usz': FAILED

# Verbose view
oradba_version.sh --verify --verbose
Extension Integrity Checks:
  ‚úó Extension 'usz': FAILED
      Modified or missing files:
        ${USZ_BASE}/sql/extension_query.sql
      Additional files (not in checksum):
        ${USZ_BASE}/sql/new.sql
```

**Features:**

- Shows which files were modified or are missing
- Detects new files not in checksum file
- Uses `${EXTENSION_BASE}` variable notation for paths
- Works with both `--verify` and `--info` commands

### ‚ú® Extension Base Environment Variables

Each loaded extension now exports a `<NAME>_BASE` environment variable pointing
to its installation directory.

**Example:**

```bash
# After sourcing environment
source oraenv.sh FREE

# Extension variables available
echo $USZ_BASE           # /opt/oracle/local/usz
echo $CUSTOMER_BASE      # /opt/oracle/local/customer

# Use in scripts
cd $USZ_BASE/sql
ls -la $CUSTOMER_BASE/bin
```

**Benefits:**

- Simplifies referencing extension paths
- Consistent naming pattern across all extensions
- Complements existing `ORADBA_EXT_<NAME>_PATH` variables
- Automatically set when extension is loaded

## Documentation Updates

### Extension Documentation

Enhanced extension documentation with checksum information:

1. **Directory Structure Examples**
   - Added `.extension.checksum` to structure diagrams
   - Shows checksum file location in extension layout

2. **Integrity Verification Section** ([18-extensions.md](../../src/doc/18-extensions.md))
   - New troubleshooting section for integrity check failures
   - Instructions for using `--verbose` mode
   - How to update checksums after intentional modifications
   - Notes about `.extension` and `log/` being excluded from verification
   - Documentation of `<NAME>_BASE` environment variables

3. **Technical Documentation** ([extension-system.md](../extension-system.md))
   - Documented `.extension.checksum` format and behavior
   - Added verbose mode examples
   - Explained automatic inclusion in GitHub releases
   - Clarified that only enabled extensions are checked
   - Documented `<NAME>_BASE` environment variables in reference table

## Upgrade Guide

### From 0.14.1 to 0.14.2

This is a patch release with backward compatibility. No action required.

**Optional:** Update extension checksums to new naming convention:

```bash
# For each extension
cd /opt/oracle/local/myextension

# If you have .myextension.checksum
mv .myextension.checksum .extension.checksum
```

### Testing After Upgrade

Verify extension status:

```bash
# Check version
oradba_version.sh --check

# Verify integrity (core + extensions)
oradba_version.sh --verify

# Show detailed info with extensions
oradba_version.sh --info

# Use verbose mode for detailed file information
oradba_version.sh --verify --verbose
```

## Breaking Changes

**None.** This release is fully backward compatible.

- Old checksum naming (`.${name}.checksum`) still works
- Existing extensions continue to function
- No configuration changes required
- New `<NAME>_BASE` variables added without affecting existing code

## Files Changed

### Modified

- `src/bin/oradba_version.sh`
  - Added `--verify-core` option for installer
  - Added `--verbose` flag for detailed extension checks
  - Standardized to `.extension.checksum` filename
  - Enhanced `check_extension_checksums()` with directory exclusion
  - Added additional file detection in verbose mode
  - Fixed color code rendering in extension status
  - Skip disabled extensions during verification
  - Exclude `.extension` and `log/` from checksum verification
  - Uses `awk` for proper checksum file parsing
  
- `src/bin/oradba_install.sh`
  - Changed from `--verify` to `--verify-core`
  - Prevents extension issues from failing installation

- `src/lib/extensions.sh`
  - Added export of `<NAME>_BASE` environment variable
  - Complements existing `ORADBA_EXT_<NAME>_PATH` variable

### Documentation

- `doc/extension-system.md`
  - Added `.extension.checksum` to directory structure
  - New integrity verification section
  - Documented checksum format and behavior

- `src/doc/18-extensions.md`
  - Added `.extension.checksum` to examples
  - New integrity check troubleshooting section
  - Instructions for updating checksums

- `CHANGELOG.md`
  - Documented all changes for 0.14.2

## Known Issues

None.

## Future Plans

- Automatic checksum generation tool for extensions
- Extension template updates with checksum generation
- Checksum verification during extension creation

## Support

For issues or questions:

- **GitHub Issues:** [oehrlis/oradba/issues](https://github.com/oehrlis/oradba/issues)
- **Documentation:** [Extension System Guide](../extension-system.md)
- **Changelog:** [CHANGELOG.md](../../CHANGELOG.md)

---

**Previous Release:** [v0.14.1](v0.14.1.md)  
**Next Release:** TBD

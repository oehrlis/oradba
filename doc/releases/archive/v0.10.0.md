# üöÄ OraDBA v0.10.0 - Enterprise Service Management & Smart Testing

**Release Date:** January 1, 2026

Major feature release introducing enterprise-grade Oracle service management and
intelligent test selection system that accelerates development by 67%.

## üéØ Highlights

### Enterprise Service Management

Complete lifecycle control for Oracle databases and listeners with systemd/init.d
integration, enabling automated startup/shutdown and production-ready service
orchestration.

### Smart Test Selection

Intelligent testing that runs only affected tests, reducing typical test execution
from 8-10 minutes to 1-3 minutes while maintaining comprehensive coverage.

### Visual Documentation

11 comprehensive diagrams updated with Mermaid definitions for better version control and GitHub rendering.

## ‚ö° Performance Improvements

| Scenario             | Before            | After             | Time Saved      |
|----------------------|-------------------|-------------------|-----------------|
| Single script change | 492 tests (8 min) | ~10 tests (1 min) | **7 minutes**   |
| Library change       | 492 tests (8 min) | ~50 tests (2 min) | **6 minutes**   |
| Documentation only   | 492 tests (8 min) | 3 tests (30 sec)  | **7.5 minutes** |

## üÜï What's New

### Oracle Service Management

**Core Scripts:**

- `oradba_dbctl.sh` - Database lifecycle management (start/stop/restart/status)
  - Honors `:Y` flag in oratab for auto-start configuration
  - Configurable shutdown timeout (default 180s) with abort escalation
  - Optional PDB opening with `--open-pdbs` flag
  - Force mode for non-interactive automation
  - Justification logging for audit trails
  
- `oradba_lsnrctl.sh` - Listener management across Oracle homes
  - Automatic discovery of first Oracle home from oratab
  - Support for multiple listeners with explicit names
  - Status reporting for all running listeners
  
- `oradba_services.sh` - Orchestrated database and listener management
  - Configurable startup/shutdown order via config file
  - Default order: start listeners‚Üídatabases, stop databases‚Üílisteners
  - Unified status reporting
  
- `oradba_services_root.sh` - Root wrapper for system integration
  - Executes services as oracle user from root context
  - Used by systemd and init.d service templates

**System Integration:**

- systemd unit file (`oradba.service`) with proper dependencies and timeouts
- init.d/chkconfig script for Red Hat and Debian systems
- Complete installation instructions for both service managers

**New Aliases (11):**

```bash
# Database management
dbctl, dbstart, dbstop, dbrestart

# Listener management  
lsnrctl, lsnrstart, lsnrstop, lsnrrestart, lsnrstatus

# Combined service management
orastart, orastop, orarestart, orastatus
```

**Configuration:**

- `oradba_services.conf` for service orchestration
- STARTUP_ORDER and SHUTDOWN_ORDER customization
- SPECIFIC_DBS and SPECIFIC_LISTENERS targeting
- DB_OPTIONS and LSNR_OPTIONS pass-through

**Documentation:**

- `17-service-management.md` (657 lines)
  - Quick start guide with examples
  - systemd and init.d installation procedures
  - Logging, error handling, and security considerations
  - Troubleshooting guide and advanced usage patterns

**Testing:**

- 51 BATS automated tests + interactive test suite
- Script existence, permissions, and syntax validation
- Help output and configuration validation
- Template structure verification

### Smart Test Selection

**Core Components:**

- `.testmap.yml` - Configuration-driven test mapping
- `scripts/select_tests.sh` - Intelligent test selection script
- `doc/smart-test-selection.md` - Complete guide (228 lines)

**Features:**

- Runs only tests affected by code changes (492 ‚Üí 5-50 tests typically)
- Always-run core tests: installer, version, oraenv
- Pattern matching for flexible test selection
- Git-based change detection with intelligent fallback
- Configuration-based mapping for complex dependencies

**New Make Targets:**

```bash
make test              # Smart selection (default, 1-3 min)
make test-full         # All 492 tests (8-10 min)
make test DRY_RUN=1    # Preview selected tests
make pre-commit        # Smart tests + linting (2-4 min)
```

**CI/CD Integration:**

- CI workflow: Smart selection for fast feedback (1-3 minutes)
- Release workflow: Full test suite for quality assurance (8-10 minutes)
- Both workflows include comprehensive linting

### Visual Documentation

**11 Updated Diagrams:**

1. CI/CD Pipeline - Smart test selection vs full test suite workflows
2. Test Strategy - Architecture of smart test selection system
3. Development Workflow - Developer decision tree with test options
4. Architecture System - Complete layered system architecture
5. oraenv.sh Flow - Environment setup process
6. Configuration Hierarchy - 5-level override system
7. Configuration Sequence - Config loading sequence diagram
8. Installation Flow - Self-extracting installer process
9. Alias Generation - Dynamic alias creation with PDB support
10. Performance Comparison - Time savings visualization
11. Test Selection Decision - Simplified test selection logic

**Formats:**

- Mermaid definitions in `doc/images/source/diagrams-mermaid.md`
- PNG exports updated in `doc/images/`
- Excalidraw sources for visual editing
- GitHub-renderable and version-controllable

## üîÑ Changes

### CI/CD Workflows

- **CI Workflow**: Uses smart test selection for faster feedback
  - Fetches full git history for proper diff comparison
  - Groups output for better readability
  - Falls back to full suite if selection fails
  
- **Release Workflow**: Ensures comprehensive validation
  - Always runs full test suite (492 tests) before release
  - Added explicit test and lint steps
  - Guarantees 100% test coverage for releases

### Build & Testing

- **Makefile**: Enhanced with smart test selection targets
  - `test` target now uses smart selection by default
  - `test-full` for complete test runs
  - `ci` target uses full tests for comprehensive validation
  - `pre-commit` uses smart tests for quick feedback

### Documentation

- **Development Guide**: Updated with smart test selection
  - Added "Available Make Targets" section
  - Expanded testing guide with smart selection examples
  - Updated GitHub Actions workflow explanations
  - Added performance comparisons and configuration examples

### Code Quality

- Fixed all shellcheck warnings for production readiness
  - Separated variable declarations from assignments (SC2155)
  - Changed `"$@"` to `"$*"` for string concatenation (SC2124)
  - Added shellcheck directives for dynamic source and config files
  - Proper variable usage in oradba_db_functions.sh (SC2034)

## üêõ Bug Fixes

- **Session Info Query**: Corrected `query_sessions_info()` to work in MOUNT and OPEN states
  - v$session is available in MOUNT mode, not just OPEN
  - Only skips STARTED (NOMOUNT) state as intended
  - Updated test to check for STARTED instead of MOUNTED

- **Memory Usage Query**: Corrected `query_memory_usage()` to work in MOUNT and OPEN states
  - v$sga and v$pgastat are available in MOUNT mode, not just OPEN
  - Only skips STARTED (NOMOUNT) state as intended
  - Updated test to check for STARTED instead of MOUNTED

## üì¶ Installation

### Download & Install

```bash
# Install latest version
curl -L -o oradba_install.sh \
  https://github.com/oehrlis/oradba/releases/latest/download/oradba_install.sh
chmod +x oradba_install.sh
./oradba_install.sh

# Or specify custom installation directory
./oradba_install.sh --prefix /opt/oradba
```

### Quick Start

```bash
# Set Oracle environment
source /opt/oradba/bin/oraenv.sh FREE

# Start all Oracle services
orastart

# Check database status
dbstatus.sh

# Run smart tests during development
make test

# Run full test suite before commits
make test-full
```

## üìä Statistics

- **Files Changed**: 21 files (1,324 insertions, 81 deletions)
- **New Files**: 3 (`.testmap.yml`, `scripts/select_tests.sh`, `doc/smart-test-selection.md`)
- **New Aliases**: 11 service management aliases
- **New Tests**: 51 BATS tests for service management
- **Total Tests**: 492 tests (all passing)
- **Documentation**: 657 lines for service management, 228 lines for smart testing
- **Diagrams**: 11 updated with Mermaid definitions

## üîó Resources

- **User Guide (PDF)**: [Download](https://github.com/oehrlis/oradba/releases/download/v0.10.0/oradba-user-guide.pdf)
- **User Guide (HTML)**: [Download](https://github.com/oehrlis/oradba/releases/download/v0.10.0/oradba-user-guide.html)
- **Installer**: [Download](https://github.com/oehrlis/oradba/releases/download/v0.10.0/oradba_install.sh)
- **Tarball**: [Download](https://github.com/oehrlis/oradba/releases/download/v0.10.0/oradba-0.10.0.tar.gz)
- **Full Changelog**: [View](https://github.com/oehrlis/oradba/blob/v0.10.0/CHANGELOG.md)

## üôè Contributors

Special thanks to all contributors who made this release possible!

## üìù License

Apache License Version 2.0 - See [LICENSE](LICENSE) for details

**Full Changelog**: <https://github.com/oehrlis/oradba/compare/v0.9.5...v0.10.0>

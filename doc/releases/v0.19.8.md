# Release Notes v0.19.8

**Release Date:** 2026-01-23  
**Type:** Minor Release (Enhanced Installation & Auto-Discovery)

## Overview

Version 0.19.8 enhances OraDBA's installation experience and auto-discovery
capabilities. Key improvements include automated profile integration with
auto-discovery, enhanced Oracle Homes management, and several critical bug
fixes for Java/client path configuration and first-login behavior.

## What's New

### ðŸš€ Enhanced Installation with Auto-Discovery Integration

**New `--enable-auto-discover` Installation Flag**

- Streamlines deployment by automatically enabling Oracle Homes auto-discovery during installation
- When combined with `--update-profile`, adds `export ORADBA_AUTO_DISCOVER_HOMES="true"` to shell profile
- Automatically discovers and registers new Oracle products into `oradba_homes.conf` on first login
- Simplifies deployment in environments with dynamic Oracle installations
- Works with both `--update-profile` and `--no-update-profile` combinations

**Benefits:**

- Eliminates manual configuration step for auto-discovery
- Ensures consistent auto-discovery behavior across environments
- Reduces setup complexity for new installations
- Ideal for automated deployments and CI/CD pipelines

**Usage Examples:**

```bash
# Install with auto-discovery enabled
bash oradba_install.sh --enable-auto-discover --update-profile

# Manual instructions will include the export when --no-update-profile is used
bash oradba_install.sh --enable-auto-discover --no-update-profile
```

### ðŸ—ï¸ New Data Safe Connector Management Tool

#### oradba_dsctl.sh: Unified Data Safe Connector Control Script

- Complete control script for managing Oracle Data Safe on-premises connectors
- Supports start/stop/restart/status operations for Data Safe connectors
- Integrates with oradba_registry API for connector discovery from `oradba_homes.conf`
- Follows same patterns and structure as `oradba_dbctl.sh` for consistency

**Key Features:**

- Automatic connector discovery using registry API (datasafe type)
- Honors autostart flag (Y) from `oradba_homes.conf`
- Justification prompt for bulk operations (similar to `oradba_dbctl.sh`)
- Graceful shutdown with configurable timeout and fallback to force kill
- Comprehensive logging using `oradba_log`
- Debug mode support via `--debug` flag or `ORADBA_DEBUG` environment variable
- Force mode (`--force`) to skip confirmation prompts
- Configurable shutdown timeout (`--timeout` or `ORADBA_SHUTDOWN_TIMEOUT`)

**Implementation Details:**

- Uses `datasafe_plugin.sh` for connector status checks
- Extracts CMAN instance name from `cman.ora` configuration
- Handles `oracle_cman_home` path adjustments automatically
- Process-based fallback when graceful shutdown times out

### ðŸ”§ Critical Bug Fixes

#### Auto-Discovery on First Login (Issue #117)

**Problem:** `ORADBA_AUTO_DISCOVER_HOMES` not triggering on first login with empty
oratab/oradba_homes.conf

**Root Cause:** Early return in `_oraenv_gather_available_entries()` prevented Oracle Home
discovery when no running instances found

**Solution:**

- Restructured control flow to attempt both instance and home discovery before returning error
- Both discovery methods now run when their respective flags are enabled
- Final error check only happens after both discovery attempts complete
- Added tests to verify correct behavior and prevent regression

**Impact:** Auto-discovery now works correctly on fresh installations

#### Java and Client Path Configuration (Issue #115)

**Problem:** `ORADBA_JAVA_PATH_FOR_NON_JAVA` and `ORADBA_CLIENT_PATH_FOR_NON_CLIENT` not being
honored during environment setup

**Root Cause:** Functions `oradba_add_java_path` and `oradba_add_client_path` were implemented
but never called from `oraenv.sh`

**Solution:**

- Added calls to both functions in environment setup after configuration loading  
- Added `ORACLE_CLIENT_HOME` export when client path is configured
- Created `_oraenv_apply_path_configs` helper function to eliminate code duplication
- Now correctly sets `JAVA_HOME` and `ORACLE_CLIENT_HOME` when configured
- Supports all three modes: 'none' (default), 'auto' (first match), and explicit home name

**Impact:** Path configuration variables now work as documented

#### DataSafe Status Detection

**Problem:** "unknown" status showing for running DataSafe connectors in `oraup.sh`

**Solution:**

- Changed `oraup.sh` to use `oradba_get_product_status()` API (same as `oradba_env.sh`)
- Removed complex direct function call logic with fallbacks
- Both commands now properly show "running" status for active DataSafe connectors

**Impact:** Consistent status reporting across all OraDBA tools

## Installation & Upgrade

### New Installation

```bash
# Enhanced installation with auto-discovery
curl -L -o oradba_install.sh \
  https://github.com/oehrlis/oradba/releases/latest/download/oradba_install.sh

# Install with auto-discovery enabled
bash oradba_install.sh --enable-auto-discover --update-profile

# Verify installation
source ~/.bash_profile
oraup.sh
```

### Upgrade from v0.19.7

```bash
# Standard upgrade
bash oradba_install.sh --update

# Enable auto-discovery on existing installation
echo 'export ORADBA_AUTO_DISCOVER_HOMES="true"' >> ~/.bash_profile

# Verify upgrade
oradba_validate.sh --version
```

### Manual Auto-Discovery Setup

For existing installations that want to enable auto-discovery:

```bash
# 1. Enable in configuration
echo 'export ORADBA_AUTO_DISCOVER_HOMES="true"' >> ${ORADBA_PREFIX}/etc/oradba_customer.conf

# 2. Run initial discovery
oradba_homes.sh discover --auto-add

# 3. Verify setup
oradba_homes.sh list
oraup.sh
```

## Technical Details

### Auto-Discovery Architecture Enhancements

**Installation Integration:**

- `oradba_install.sh` now supports `--enable-auto-discover` flag
- Profile integration includes auto-discovery export statement
- Manual instructions updated to include auto-discovery setup
- Works consistently across interactive and non-interactive installations

**Configuration Flow:**

1. Installation detects `--enable-auto-discover` flag
2. Profile update includes `export ORADBA_AUTO_DISCOVER_HOMES="true"`
3. First login triggers auto-discovery via `oraenv.sh`
4. Oracle Homes automatically registered in `oradba_homes.conf`
5. Subsequent logins maintain registry without rescanning

### Data Safe Connector Management

**Control Script Architecture:**

- Location: `src/bin/oradba_dsctl.sh`
- 50 comprehensive BATS tests covering all functionality
- Integration with existing OraDBA libraries and plugins
- Consistent command structure with other control scripts

**Process Management:**

- Uses `cmctl` command for graceful connector management
- Process-based fallback for unresponsive connectors
- Configurable timeouts with automatic escalation
- Comprehensive error handling and logging

## Compatibility

### Backward Compatibility

âœ… **Fully backward compatible** with OraDBA v0.19.x  
âœ… **Configuration files** preserved during upgrade  
âœ… **Existing scripts** continue to work unchanged  
âœ… **API compatibility** maintained for all public functions  
âœ… **Auto-discovery** is opt-in (disabled by default)  

### Platform Support

âœ… **RHEL/Oracle Linux** 7, 8, 9  
âœ… **Ubuntu** 18.04, 20.04, 22.04, 24.04  
âœ… **SUSE Linux Enterprise** 12, 15  
âœ… **macOS** 11+ (Intel and Apple Silicon)  

## Breaking Changes

None. This release maintains full backward compatibility.

## Known Issues

- Auto-discovery may not detect Oracle installations with non-standard directory structures
- Data Safe connector management requires proper `cmctl` configuration
- PATH configuration variables require logout/login or manual sourcing to take effect

## Support Information

- **Documentation**: [OraDBA Documentation](https://oehrlis.github.io/oradba/)
- **Issues**: [GitHub Issues](https://github.com/oehrlis/oradba/issues)
- **Changelog**: [CHANGELOG.md](../../../CHANGELOG.md)

## Next Release

OraDBA v0.19.9 will focus on:

- Enhanced WebLogic Server support and management
- Improved Grid Infrastructure integration
- Advanced monitoring and alerting capabilities
- Performance optimizations for large-scale environments

---

**Full Changelog**: [v0.19.7...v0.19.8](https://github.com/oehrlis/oradba/compare/v0.19.7...v0.19.8)

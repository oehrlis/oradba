# OraDBA Release 0.18.0 - Oracle Homes Support

**Release Date:** January 10, 2026

## Overview

This release introduces **Oracle Homes Support**, extending OraDBA beyond database-only management to support all Oracle products including Oracle Unified Directory (OUD), WebLogic Server, Oracle Client, Enterprise Manager, Data Safe connectors, and more. The new management framework provides unified environment setup, auto-discovery, and comprehensive CLI tools for managing multi-product Oracle installations.

## What's New

### Oracle Homes Infrastructure (Phase 1)

Core framework for managing non-database Oracle products:

**Configuration File:** `${ORADBA_BASE}/etc/oradba_homes.conf`

```bash
# Format: NAME:ORACLE_HOME:PRODUCT_TYPE:ORDER:DESCRIPTION
OUD12:/u01/app/oracle/product/12.2.1.4/oud:oud:10:Oracle Unified Directory 12c
WLS14:/u01/app/oracle/product/14.1.1.0/wls:weblogic:20:WebLogic Server 14c
CLIENT19:/u01/app/oracle/product/19.0.0.0/client:client:30:Oracle Client 19c
DATASAFE:/u01/app/oracle/product/datasafe:datasafe:40:Data Safe Connector
```

**Supported Product Types:**

- `database` - Oracle Database (existing functionality)
- `oud` - Oracle Unified Directory
- `client` - Oracle Client
- `weblogic` - WebLogic Server
- `oms` - Enterprise Manager OMS
- `emagent` - Enterprise Manager Agent
- `datasafe` - Oracle Data Safe

**Core Functions in common.sh:**

- `get_oracle_homes_path()` - Get path to configuration file
- `parse_oracle_home()` - Parse home entry by name
- `list_oracle_homes()` - List all homes sorted by order
- `get_oracle_home_path()` - Get ORACLE_HOME path for named home
- `get_oracle_home_type()` - Get product type
- `detect_product_type()` - Auto-detect type from filesystem
- `set_oracle_home_environment()` - Set product-specific variables
- `is_oracle_home()` - Distinguish Oracle Homes from database SIDs

### Unified Environment Setup (Phase 2)

Enhanced `oraenv.sh` to support both databases and Oracle products:

```bash
# Setup database (existing)
source oraenv.sh DB19C

# Setup OUD instance
source oraenv.sh OUD12

# Setup WebLogic Server
source oraenv.sh WLS14

# Interactive menu shows both
source oraenv.sh
```

**Interactive Menu:**

```
Available Oracle Environments:
────────────────────────────────────────────────────
Oracle Homes:
  [oud]      OUD12       - Oracle Unified Directory 12c
  [weblogic] WLS14       - WebLogic Server 14c
  [client]   CLIENT19    - Oracle Client 19c

Database Instances:
  DB19C      (/u01/app/oracle/product/19.3.0/dbhome_1) : Y
  ORCL       (/u01/app/oracle/product/19.0.0/dbhome_2) : Y
────────────────────────────────────────────────────
Enter SID or Home name:
```

**Enhanced `oraup.sh` Display:**

```bash
oraup.sh

Oracle Homes:
────────────────────────────────────────────────────
  ✓ OUD12      (oud)      - Oracle Unified Directory 12c
  ✓ WLS14      (weblogic) - WebLogic Server 14c
  ✓ CLIENT19   (client)   - Oracle Client 19c

Oracle Databases:
────────────────────────────────────────────────────
  ✓ DB19C      - OPEN (ARCHIVELOG) - CDB with 2 PDBs
  ✓ ORCL       - OPEN (NOARCHIVELOG)
```

### Management CLI Tool (Phase 3)

New `oradba_homes.sh` command-line tool for Oracle Homes management:

```bash
# List all registered homes
oradba_homes.sh list

# Filter by product type
oradba_homes.sh list --type oud

# Detailed listing
oradba_homes.sh list --verbose

# Show specific home details
oradba_homes.sh show OUD12

# Add new Oracle Home
oradba_homes.sh add \
  --name WLS14 \
  --path /u01/app/oracle/product/14.1.1.0/wls \
  --type weblogic \
  --desc "WebLogic Server 14c"

# Interactive add (prompts for details)
oradba_homes.sh add

# Remove Oracle Home
oradba_homes.sh remove OUD12

# Auto-discover under $ORACLE_BASE/product
oradba_homes.sh discover

# Dry-run discovery
oradba_homes.sh discover --dry-run

# Auto-add discovered homes
oradba_homes.sh discover --auto-add

# Validate configuration
oradba_homes.sh validate

# Validate specific home
oradba_homes.sh validate WLS14
```

**Management Features:**

- **Auto-Detection:** Detects product types from filesystem markers
- **Interactive Mode:** Prompts for missing parameters with validation
- **Non-Interactive Mode:** TTY detection for CI/CD environments
- **Input Validation:** Name format, product types, duplicates
- **Backup Creation:** Automatic backup before removal
- **Dry-Run Mode:** Preview changes before applying

## Use Cases

### Multi-Product Oracle Environments

```bash
# Register all Oracle products
oradba_homes.sh add --name OUD12 \
  --path /u01/app/oracle/product/12.2.1.4/oud --type oud

oradba_homes.sh add --name WLS14 \
  --path /u01/app/oracle/product/14.1.1.0/wls --type weblogic

oradba_homes.sh add --name DATASAFE \
  --path /u01/app/oracle/datasafe --type datasafe

# Switch environments as needed
source oraenv.sh OUD12
cd $ORACLE_HOME/oud/bin
./oud-setup --help

source oraenv.sh WLS14
cd $DOMAIN_HOME
./startWebLogic.sh
```

### Auto-Discovery in Fresh Installations

```bash
# After installing multiple Oracle products
export ORACLE_BASE=/u01/app/oracle

# Discover all products automatically
oradba_homes.sh discover --auto-add

# Review what was found
oradba_homes.sh list --verbose

# Validate all configurations
oradba_homes.sh validate
```

### CI/CD Pipeline Integration

```yaml
jobs:
  setup-oracle:
    steps:
      - name: Discover Oracle Homes
        run: |
          oradba_homes.sh discover --auto-add
          
      - name: Validate Configuration
        run: |
          if ! oradba_homes.sh validate; then
            echo "Configuration validation failed"
            exit 1
          fi
          
      - name: Test Environment Setup
        run: |
          source oraenv.sh OUD12
          test -n "$ORACLE_HOME"
          test -d "$ORACLE_HOME"
```

### Data Safe On-Premises Connector Management

```bash
# Register Data Safe connector
oradba_homes.sh add \
  --name DATASAFE_PROD \
  --path /opt/oracle/datasafe/connector \
  --type datasafe \
  --desc "Data Safe Production Connector"

# Setup environment for connector management
source oraenv.sh DATASAFE_PROD

# Check connector status
$ORACLE_HOME/bin/cmctl show service
```

## Installation

### New Installation

```bash
# Download installer
curl -L -o oradba_install.sh \
  https://github.com/oehrlis/oradba/releases/latest/download/oradba_install.sh

# Install OraDBA
bash oradba_install.sh

# Discover Oracle Homes automatically
oradba_homes.sh discover --auto-add
```

### Upgrade from Previous Versions

```bash
# Backup current installation
tar czf ~/oradba-backup-$(date +%Y%m%d).tar.gz ${ORADBA_BASE:-/opt/oradba}

# Download new version
curl -L -o oradba_install.sh \
  https://github.com/oehrlis/oradba/releases/v0.18.0/download/oradba_install.sh

# Run installer (preserves configuration)
bash oradba_install.sh

# Reload environment
source oraenv.sh $(echo $ORACLE_SID)

# Discover additional Oracle products
oradba_homes.sh discover --auto-add
```

## Configuration

### Manual Configuration

Create or edit `${ORADBA_BASE}/etc/oradba_homes.conf`:

```bash
# Oracle Unified Directory
OUD12:/u01/app/oracle/product/12.2.1.4/oud:oud:10:Oracle Unified Directory 12c

# WebLogic Server
WLS14:/u01/app/oracle/product/14.1.1.0/wls:weblogic:20:WebLogic Server 14c

# Oracle Client
CLIENT19:/u01/app/oracle/product/19.0.0.0/client:client:30:Oracle Client 19c

# Enterprise Manager OMS
OMS13:/u01/app/oracle/middleware:oms:40:Enterprise Manager OMS 13c

# Data Safe Connector
DATASAFE:/opt/oracle/datasafe:datasafe:50:Data Safe On-Prem Connector
```

### Display Ordering

Oracle Homes are displayed by the ORDER field (ascending):

- Lower numbers appear first (e.g., 10, 20, 30)
- Use increments of 10 for easy insertion
- Database SIDs always display after Oracle Homes

## Product-Specific Notes

### Oracle Unified Directory (OUD)

**Environment Variables Set:**

- `ORACLE_HOME` - OUD installation home
- `ORACLE_INSTANCE` - OUD instance directory (if exists)
- `PATH` - Includes `$ORACLE_HOME/bin`

**Typical Structure:**

```
/u01/app/oracle/product/12.2.1.4/oud/     # ORACLE_HOME
  bin/
  lib/
  oud/
/u01/app/oracle/oud_instances/oud1/       # ORACLE_INSTANCE
  OUD/
    config/
    logs/
```

### WebLogic Server

**Environment Variables Set:**

- `ORACLE_HOME` - WebLogic installation
- `MW_HOME` - Middleware home (same as ORACLE_HOME)
- `WL_HOME` - `$ORACLE_HOME/wlserver`
- `DOMAIN_HOME` - WebLogic domain (if detected)
- `PATH` - Includes `$ORACLE_HOME/oracle_common/bin`

### Oracle Client

**Environment Variables Set:**

- `ORACLE_HOME` - Client installation
- `LD_LIBRARY_PATH` - Client libraries
- `PATH` - Client binaries (sqlplus, tnsping, etc.)
- `TNS_ADMIN` - `$ORACLE_HOME/network/admin`

### Data Safe On-Premises Connector

**Environment Variables Set:**

- `ORACLE_HOME` - Connector installation
- `PATH` - Connector management tools
- `TNS_ADMIN` - Network configuration

**Management:**

```bash
source oraenv.sh DATASAFE
cmctl show service      # Check connector status
cmctl start service     # Start connector
cmctl show wallet       # View wallet information
```

## Testing

### Comprehensive Test Coverage

**Unit Tests (28 tests):**

- Configuration file parsing
- Product type detection
- Environment variable setting
- Home priority and filtering

**Integration Tests (3 tests):**

- oraenv.sh Oracle Home selection
- Environment setup validation
- Priority over database SIDs

**Management Tool Tests (39 tests):**

- List command (5 tests)
- Show command (3 tests)
- Add command (9 tests) - validation, detection, ordering
- Remove command (5 tests) - confirmation, backup
- Discover command (6 tests) - scanning, auto-add, dry-run
- Validate command (5 tests) - existence, type checks
- Integration tests (2 tests) - full workflow

**All Tests Passing:** 70 tests total (100% success rate)

## Breaking Changes

**None.** This release is fully backward compatible:

- Existing database functionality unchanged
- New Oracle Homes feature is opt-in
- Configuration files are separate
- No changes to existing scripts behavior

## Known Issues

- Discovery only scans `$ORACLE_BASE/product/*` (by design)
- Manual registration required for non-standard paths
- WebLogic domain detection requires standard structure

## Migration Guide

No migration required. To start using Oracle Homes:

```bash
# Option 1: Auto-discover
oradba_homes.sh discover --auto-add

# Option 2: Manual registration
oradba_homes.sh add --name OUD12 \
  --path /u01/app/oracle/product/12.2.1.4/oud \
  --type oud

# Verify configuration
oradba_homes.sh list
oradba_homes.sh validate
```

## Documentation

- [Oracle Homes Architecture](../v0.18.0-oracle-homes-support.md)
- [CHANGELOG.md](../../CHANGELOG.md#unreleased)
- [README.md](../../README.md)

## Contributors

- Stefan Oehrli (@oehrlis)

## Links

- [Release Page](https://github.com/oehrlis/oradba/releases/tag/v0.18.0)
- [Full Changelog](https://github.com/oehrlis/oradba/compare/v0.17.0...v0.18.0)
- [Issues](https://github.com/oehrlis/oradba/issues)

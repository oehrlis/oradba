# Release Notes - OraDBA v0.14.1

**Release Date:** January 6, 2026  
**Release Type:** Feature Release  
**Focus:** Complete RMAN Script Library + Recovery Templates

## Overview

Version 0.14.1 completes the RMAN script library with 10 additional scripts, bringing
the total to **34 comprehensive RMAN templates** covering backup, maintenance, reporting,
and recovery operations. This release adds crucial recovery scripts and backup-specific
templates (archive logs, controlfiles) that complement the existing incremental backup
strategy.

## What's New

### âœ¨ New Features

#### CLI Parameters for Selective Backups

Added command-line parameters to `oradba_rman.sh` for more flexible backup scope control:

- **`--tablespaces <names>`**: Specify tablespace names (comma-separated)
  - Example: `--tablespaces USERS,TOOLS,DATA`
  - Overrides `RMAN_TABLESPACES` config variable
  - Preferred over config for one-time or scripted backups

- **`--datafiles <numbers>`**: Specify datafile numbers or paths (comma-separated)
  - Example: `--datafiles 4,5,6` (by number)
  - Example: `--datafiles "/u01/oradata/file1.dbf,/u01/oradata/file2.dbf"` (by path)
  - Overrides `RMAN_DATAFILES` config variable

- **`--pdb <names>`**: Specify pluggable database names (comma-separated)
  - Example: `--pdb PDB1,PDB2,PDB3`
  - Overrides `RMAN_PLUGGABLE_DATABASE` config variable
  - Used for selective PDB backups in container databases

**Usage Examples:**

```bash
# Backup specific tablespaces via CLI
oradba_rman.sh --sid PROD --rcv bck_inc0_ts.rcv --tablespaces USERS,TOOLS

# Backup specific datafiles via CLI
oradba_rman.sh --sid PROD --rcv bck_inc0_df.rcv --datafiles 4,5,6

# Backup datafiles by path
oradba_rman.sh --sid PROD --rcv bck_inc0.rcv \
    --datafiles "/u01/oradata/PROD/users01.dbf,/u01/oradata/PROD/users02.dbf"

# Backup specific pluggable databases
oradba_rman.sh --sid CDB1 --rcv bck_inc0_pdb.rcv --pdb PDB1,PDB2
```

#### Extended RMAN Script Library (10 new scripts)

**Backup Scripts (2 new):**

- **`bck_arc.rcv`** - Archive logs backup only
  - Backs up archivelogs without forcing logswitch
  - Useful after archiver stuck or for on-demand archivelog backups
  - Supports `<ARCHIVE_RANGE>` and `<ARCHIVE_PATTERN>` filtering
  - Includes controlfile and SPFILE backup

- **`bck_ctl.rcv`** - Controlfile backup only
  - Standalone controlfile backup
  - Creates text pfile from SPFILE
  - Backs up controlfile to trace
  - Useful for frequent controlfile protection

**Recovery Scripts (8 new):**

All recovery scripts converted from TVD Backup to OraDBA format with:

- Updated headers (OraDBA standard)
- Template tag support (`<ALLOCATE_CHANNELS>`, `<RELEASE_CHANNELS>`, `<SET_COMMANDS>`)
- Improved documentation and usage notes
- Cleaned syntax and formatting

1. **`rcv_arc.rcv`** - Restore archivelogs by sequence number range
   - Syntax: `restore archivelog from sequence=<FIRST> until sequence=<LAST> thread=1`
   - For RAC: adjust thread parameter

2. **`rcv_ctl.rcv`** - Restore controlfile from backup
   - Options: from autobackup, from specific backup piece, or from latest backup
   - Automatically mounts database after restore

3. **`rcv_db.rcv`** - Complete database recovery
   - Assumes controlfiles still in place and valid
   - Supports CHECK READONLY for read-only tablespaces
   - Opens database normally (no RESETLOGS)

4. **`rcv_db_pitr.rcv`** - Database point-in-time recovery (PITR)
   - Uses SET UNTIL TIME for recovery point
   - Optional controlfile restore if structural changes occurred
   - Manual OPEN RESETLOGS required after recovery

5. **`rcv_df.rcv`** - Datafile recovery
   - Recovers one or more datafiles
   - Offline/online management
   - Single restore statement for performance

6. **`rcv_standby_db.rcv`** - Create standby database
   - Duplicates target database for standby
   - Requires RMAN catalog connection
   - Assumes same directory structure on primary/standby

7. **`rcv_ts.rcv`** - Tablespace recovery
   - Recovers one or more tablespaces
   - Uses OFFLINE IMMEDIATE
   - Single restore statement for performance

8. **`rcv_ts_pitr.rcv`** - Tablespace point-in-time recovery (TSPITR)
   - Recovers tablespace to specific point in time
   - Requires auxiliary destination
   - Uses UNTIL TIME syntax

#### Extended Template Tag Support

**3 New Template Tags:**

- **`<SPFILE_BACKUP>`** - Conditional SPFILE text backup
  - Controlled by `RMAN_SPFILE_BACKUP=true|false` (default: true)
  - When enabled: Creates pfile from spfile
  - When disabled: Removes lines containing tag
  - Affects 13 backup scripts

- **`<BACKUP_KEEP_TIME>`** - Long-term retention
  - Syntax: `KEEP UNTIL TIME 'SYSDATE+365'`
  - Used in `bck_db_keep.rcv` for guaranteed retention backups
  - Optional: leave empty to skip KEEP clause

- **`<RESTORE_POINT>`** - Guaranteed restore point
  - Creates restore point for long-term recovery capability
  - Used in `bck_db_keep.rcv`
  - Optional: leave empty to skip restore point creation

**Tag Replacement:**

- Replaced legacy `<BCK_PATH>` with `<BACKUP_PATH>` in 12 files (28 occurrences)
- Ensures consistency across all backup scripts
- Maintains backward compatibility through wrapper processing

### ï¿½ Bug Fixes

#### RMAN Maintenance Scripts Syntax Error

**Problem:** Three maintenance scripts failed with RMAN syntax errors when
executing `ALLOCATE CHANNEL` commands outside of a `RUN` block.

**Error Messages:**

```text
RMAN-00558: error encountered while parsing input commands
RMAN-01009: syntax error: found "identifier": expecting one of: "for"
RMAN-01008: the bad identifier was: ch1
```

**Fixed Scripts:**

- `mnt_del_obs.rcv`: Added `RUN { }` block around channel allocation and delete operations
- `mnt_chk.rcv`: Added `RUN { }` block around channel allocation and crosscheck commands
- `mnt_del_obs_nomaint.rcv`: Removed hardcoded default channel, uses only template tags

**Impact:** All maintenance scripts now execute correctly without RMAN parsing errors.

#### rlwrap Double-Exit Issue in RMAN

**Problem:** When using `rmanh` or `rmanch` aliases (RMAN with rlwrap), typing
`exit` once showed "Recovery Manager complete" but immediately started a new
RMAN session, requiring a second `exit` to fully terminate.

**Root Cause:** The rlwrap filter (`src/etc/rlwrap_filter_oracle`) returned an
empty string `""` for password prompt inputs. This caused rlwrap to misinterpret
subsequent commands, including `exit`.

**Fix:** Modified input handler to:

- Return the actual input value instead of empty string
- Use `send_output_oob("\x00")` to signal rlwrap not to save to history
- Maintains password hiding while preserving proper command flow

**Impact:** Single `exit` command now properly terminates RMAN sessions wrapped with rlwrap.

#### longops.sh Output Formatting

**Problem:** The `longops.sh` script displayed operation monitoring with line wrapping issues:

- "Remaining" time column wrapped to next line ("000: 00:\n  07")
- Message text truncated or wrapped unexpectedly
- Empty lines in output

**Fixes Applied:**

- Increased `LINESIZE` from 120 to 160 for wider terminal support
- Added `SET TRIMOUT ON` and `SET TRIMSPOOL ON` to remove trailing spaces
- Changed time formatting from `TO_CHAR` with format masks to `LPAD` function
- Fixed time_remain to display as "000:00:08" instead of " 000:  00:  08" (no extra spaces)
- Increased `message` column width from A35 to A50 for longer descriptions
- Added `WORD_WRAPPED` attribute to prevent mid-word line breaks

**Impact:** Clean, single-line output for all long operation entries without wrapping or empty lines.

#### RMAN Command Syntax (SET vs CONFIGURE)

**Problem:** Some scripts and documentation examples used `SET` command for
persistent RMAN configuration, which is incorrect RMAN syntax.

**RMAN Command Distinction:**

- `CONFIGURE`: Persistent configuration stored in controlfile/catalog (survives RMAN sessions)
- `SET`: Session-specific settings (lost when RMAN exits)

**Fixed Locations:**

- `mnt_reg.rcv`: Changed `SET SNAPSHOT CONTROLFILE NAME` â†’ `CONFIGURE SNAPSHOT CONTROLFILE NAME`
- `src/doc/09-rman-scripts.md`: Updated examples:
  - `SET BACKUP OPTIMIZATION ON` â†’ `CONFIGURE BACKUP OPTIMIZATION ON`
  - `SET ARCHIVELOG DELETION POLICY` â†’ `CONFIGURE ARCHIVELOG DELETION POLICY`

**Impact:** All persistent RMAN settings now use correct `CONFIGURE` syntax, preventing potential errors in production use.

### ï¿½ðŸ“š Documentation Updates

#### src/rcv/README.md

- Added all 10 new scripts to documentation
- New "Recovery Scripts" section with 8 scripts
- Updated totals: **34 scripts** (18 backup + 7 maintenance + 1 reporting + 8 recovery)
- Improved categorization and descriptions

#### src/doc/09-rman-scripts.md

- Added 3 new template tags documentation (`SPFILE_BACKUP`, `BACKUP_KEEP_TIME`, `RESTORE_POINT`)
- Added CLI parameter documentation (`--tablespaces`, `--datafiles`, `--pdb`)
- Configuration examples for new parameters
- Usage examples for recovery operations and selective backups

#### CHANGELOG.md

- Comprehensive v0.14.1 release notes
- Detailed listing of all 10 new scripts
- Template tag changes documented

### ðŸ”„ Script Updates

**All 34 RMAN Scripts:**

- Version updated to 0.14.1
- Consistent OraDBA header format
- Proper revision tracking
- Apache License 2.0 reference

**Quality Improvements:**

- Consistent uppercase/lowercase formatting
- Improved inline comments
- Better usage instructions
- Standardized template tag usage

## Complete RMAN Script Library

### Backup Scripts (18)

| Script                | Description                           |
|-----------------------|---------------------------------------|
| backup_full.rcv       | Full database backup with archives    |
| bck_arc.rcv           | Archive logs backup only              |
| bck_ctl.rcv           | Controlfile backup only               |
| bck_db_keep.rcv       | Full backup with retention guarantee  |
| bck_db_validate.rcv   | Database validation                   |
| bck_inc0.rcv          | Incremental level 0 with archives     |
| bck_inc0_noarc.rcv    | Incremental level 0 without archives  |
| bck_inc0_cold.rcv     | Offline incremental level 0           |
| bck_inc0_df.rcv       | Level 0 for specific datafiles        |
| bck_inc0_pdb.rcv      | Level 0 for pluggable databases       |
| bck_inc0_rec_area.rcv | Level 0 to recovery area              |
| bck_inc0_ts.rcv       | Level 0 for specific tablespaces      |
| bck_inc1c.rcv         | Cumulative level 1 with archives      |
| bck_inc1c_noarc.rcv   | Cumulative level 1 without archives   |
| bck_inc1d.rcv         | Differential level 1 with archives    |
| bck_inc1d_noarc.rcv   | Differential level 1 without archives |
| bck_recovery_area.rcv | Fast recovery area backup             |
| bck_standby_inc0.rcv  | Level 0 for standby setup             |

### Maintenance Scripts (7)

| Script                  | Description                                    |
|-------------------------|------------------------------------------------|
| mnt_chk.rcv             | Crosscheck backups and delete expired          |
| mnt_chk_arc.rcv         | Crosscheck archive logs                        |
| mnt_del_arc.rcv         | Delete archive logs                            |
| mnt_del_obs.rcv         | Delete obsolete backups                        |
| mnt_del_obs_nomaint.rcv | Delete obsolete without maintenance window     |
| mnt_reg.rcv             | Register database and set snapshot controlfile |
| mnt_sync.rcv            | Resync RMAN catalog                            |

### Reporting Scripts (1)

| Script      | Description                           |
|-------------|---------------------------------------|
| rpt_bck.rcv | Report backup status and requirements |

### Recovery Scripts (8)

| Script             | Description                       |
|--------------------|-----------------------------------|
| rcv_arc.rcv        | Restore archivelogs by sequence   |
| rcv_ctl.rcv        | Restore controlfile               |
| rcv_db.rcv         | Complete database recovery        |
| rcv_db_pitr.rcv    | Database point-in-time recovery   |
| rcv_df.rcv         | Datafile recovery                 |
| rcv_standby_db.rcv | Create standby database           |
| rcv_ts.rcv         | Tablespace recovery               |
| rcv_ts_pitr.rcv    | Tablespace point-in-time recovery |

## Configuration

### New Parameters in oradba_rman.conf

```bash
# ------------------------------------------------------------------------------
# SPFILE Backup Configuration
# ------------------------------------------------------------------------------
# Enable SPFILE text backup (pfile creation from spfile)
export RMAN_SPFILE_BACKUP="true"

# ------------------------------------------------------------------------------
# Long-Term Retention Configuration
# ------------------------------------------------------------------------------
# Backup keep time for guaranteed retention (only for bck_db_keep.rcv)
export RMAN_BACKUP_KEEP_TIME=""
# Example: export RMAN_BACKUP_KEEP_TIME="KEEP UNTIL TIME 'SYSDATE+365'"

# Restore point for guaranteed restore capability (only for bck_db_keep.rcv)
export RMAN_RESTORE_POINT=""
# Example: export RMAN_RESTORE_POINT="backup_rp_$(date +%Y%m%d)"
```

## Usage Examples

### Archive Logs Backup

```bash
# Backup all available archivelogs
oradba_rman.sh --sid PROD --rcv bck_arc.rcv

# Backup recent archivelogs (last 24 hours)
export RMAN_ARCHIVE_RANGE="FROM TIME 'SYSDATE-1'"
oradba_rman.sh --sid PROD --rcv bck_arc.rcv

# Backup specific archivelog pattern
export RMAN_ARCHIVE_PATTERN="LIKE '/arch/prod_%'"
oradba_rman.sh --sid PROD --rcv bck_arc.rcv
```

### Controlfile Backup

```bash
# Standalone controlfile backup
oradba_rman.sh --sid PROD --rcv bck_ctl.rcv

# Schedule frequent controlfile backups
0 */6 * * * /path/to/oradba_rman.sh --sid PROD --rcv bck_ctl.rcv
```

### Database Recovery

```bash
# Complete database recovery
oradba_rman.sh --sid PROD --rcv rcv_db.rcv

# Tablespace recovery (edit <TABLESPACES> in script first)
oradba_rman.sh --sid PROD --rcv rcv_ts.rcv

# Datafile recovery (edit <DATAFILES> in script first)
oradba_rman.sh --sid PROD --rcv rcv_df.rcv
```

### Point-in-Time Recovery

```bash
# Database PITR (edit recovery time in script)
# 1. Edit rcv_db_pitr.rcv: set until time "to_date('06-01-26 10:00','DD-MM-YY HH24:MI')"
# 2. Execute recovery
oradba_rman.sh --sid PROD --rcv rcv_db_pitr.rcv
# 3. Manually: alter database open resetlogs;

# Tablespace PITR (edit recovery time and tablespaces in script)
oradba_rman.sh --sid PROD --rcv rcv_ts_pitr.rcv
```

### Guaranteed Retention Backup

```bash
# Configure long-term retention
export RMAN_BACKUP_KEEP_TIME="KEEP UNTIL TIME 'SYSDATE+365'"
export RMAN_RESTORE_POINT="yearly_backup_$(date +%Y%m%d)"

# Execute guaranteed retention backup
oradba_rman.sh --sid PROD --rcv bck_db_keep.rcv
```

## Upgrade Notes

### Breaking Changes

None. All changes are backward compatible.

### Recommendations

1. **Review recovery scripts** before production use:
   - Edit placeholder values (`<TABLESPACES>`, `<DATAFILES>`, `<FIRST_SEQUENCE>`, etc.)
   - Adjust recovery points and parameters for your environment
   - Test recovery procedures in non-production environments

2. **Update RMAN configuration** if using new features:
   - Set `RMAN_SPFILE_BACKUP=true|false` based on your requirements
   - Configure `RMAN_BACKUP_KEEP_TIME` for long-term retention needs
   - Set `RMAN_RESTORE_POINT` naming convention

3. **Leverage archive log backups**:
   - Use `bck_arc.rcv` for frequent archivelog backups
   - Separate from full database backups for flexibility
   - Reduce backup window for large databases

4. **Document recovery procedures**:
   - Customize recovery scripts for your environment
   - Test recovery paths regularly
   - Update runbooks with OraDBA recovery commands

## Migration Path

### From 0.14.0 to 0.14.1

```bash
# 1. Pull latest changes
cd $ORADBA_BASE
git pull origin main

# 2. Verify new scripts
ls -l src/rcv/bck_arc.rcv src/rcv/bck_ctl.rcv src/rcv/rcv_*.rcv

# 3. Update configuration (optional)
vi $ORADBA_ORA_ADMIN_SID/etc/oradba_rman.conf
# Add: export RMAN_SPFILE_BACKUP="true"

# 4. Test new backup scripts
oradba_rman.sh --sid TEST --rcv bck_arc.rcv --dry-run
oradba_rman.sh --sid TEST --rcv bck_ctl.rcv --dry-run

# 5. Review recovery scripts
vi src/rcv/rcv_db.rcv
vi src/rcv/rcv_ts.rcv
# Customize for your environment
```

## Known Issues

None.

## Deprecation Notices

None.

## Contributors

- Stefan Oehrli (@oehrlis)

## Files Changed

```text
Modified (37 files):
- VERSION: 0.14.0 â†’ 0.14.1
- CHANGELOG.md: Added v0.14.1 release notes with bug fixes
- src/rcv/README.md: Added 10 new scripts, updated totals
- src/doc/09-rman-scripts.md: Added new tags, CLI params, examples
- src/bin/oradba_rman.sh: Extended template support, added --tablespaces/--datafiles CLI params
- src/bin/longops.sh: Fixed output formatting (LINESIZE, column widths)
- src/etc/oradba_rman.conf.example: Added 3 new parameters
- src/etc/rlwrap_filter_oracle: Fixed double-exit issue
- src/rcv/mnt_del_obs.rcv: Added RUN block for proper RMAN syntax
- src/rcv/mnt_chk.rcv: Added RUN block for proper RMAN syntax
- src/rcv/mnt_del_obs_nomaint.rcv: Added RUN block, removed hardcoded channel
- src/rcv/mnt_reg.rcv: Fixed SET â†’ CONFIGURE SNAPSHOT CONTROLFILE
- All 34 src/rcv/*.rcv scripts: Version 0.14.0 â†’ 0.14.1

Added (11 files):
- src/rcv/bck_arc.rcv: Archive logs backup
- src/rcv/bck_ctl.rcv: Controlfile backup
- src/rcv/rcv_arc.rcv: Archivelog restore
- src/rcv/rcv_ctl.rcv: Controlfile restore
- src/rcv/rcv_db.rcv: Database recovery
- src/rcv/rcv_db_pitr.rcv: Database PITR
- src/rcv/rcv_df.rcv: Datafile recovery
- src/rcv/rcv_standby_db.rcv: Standby creation
- src/rcv/rcv_ts.rcv: Tablespace recovery
- src/rcv/rcv_ts_pitr.rcv: Tablespace PITR
- doc/releases/v0.14.1.md: This release document

Total: 48 files changed, ~650 insertions, ~180 deletions
```

## Download

- **GitHub Release**: <https://github.com/oehrlis/oradba/releases/tag/v0.14.1>
- **Git Tag**: `git checkout v0.14.1`

---

**Full Changelog**: <https://github.com/oehrlis/oradba/compare/v0.14.0...v0.14.1>

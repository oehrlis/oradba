# Release v0.18.2 - Oracle Home Aliases Bug Fixes

**Release Date:** 2026-01-12  
**Type:** Patch Release (Bug Fixes)

## Overview

Critical bug fix release addressing multiple issues with Oracle Home alias
functionality introduced in v0.18.1. This release ensures Oracle Home aliases
work correctly at shell startup and follow consistent naming conventions.

## Critical Fixes

### Oracle Home Alias Resolution

**Issue:** Oracle Home aliases (e.g., `rdbms26`) were not working properly due
to circular reference bugs and incorrect configuration file paths.

**Fixed:**

- `parse_oracle_home()` now resolves alias names to actual NAME before lookup
- Added `resolve_oracle_home_name()` function to handle both NAME and ALIAS_NAME
- `set_oracle_home_environment()` properly resolves aliases to prevent circular
  references
- Alias creation now uses actual NAME: `alias rdbms26='. oraenv.sh DBHOMEFREE'`

**Impact:** Oracle Home aliases now work correctly from shell startup.

### Configuration File Path Bug

**Issue:** Both `generate_sid_lists()` and `generate_oracle_home_aliases()`
were using wrong config file path, preventing aliases from being created at
shell initialization.

**Wrong paths:**

```bash
${ORADBA_ETC}/oracle_homes.conf  # Wrong filename
```

**Correct path:**

```bash
${ORADBA_BASE}/etc/oradba_homes.conf  # Via get_oracle_homes_path()
```

**Impact:** Oracle Home aliases and SIDLIST entries now properly created at
shell startup.

## Enhancements

### Lowercase Alias Convention

Oracle Home aliases now default to lowercase, consistent with database SID
alias convention:

**Before:**

- Database: `FREE` → alias `free`
- Oracle Home: `DBHOMEFREE` → alias `DBHOMEFREE` (inconsistent)

**After:**

- Database: `FREE` → alias `free`
- Oracle Home: `DBHOMEFREE` → alias `dbhomefree` (consistent)

Custom aliases still supported: `--alias rdbms26`

### ORADBA_SIDLIST Enhancement

Extended to include Oracle Home names and aliases:

- `ORADBA_REALSIDLIST`: Real database SIDs only (Y/N/S flags)
- `ORADBA_SIDLIST`: All sourceable names (SIDs + dummies + Oracle Home
  names/aliases)

**Example:**

```bash
ORADBA_REALSIDLIST=FREE
ORADBA_SIDLIST=FREE DBHOMEFREE rdbms26
```

### Display Improvements

- `oraup.sh` now shows alias name instead of full NAME for better readability
- Example: Shows `rdbms26` instead of `DBHOMEFREE`

## Additional Fixes

### Empty Dummy Array Display

Fixed phantom "Dummy rdbms" line appearing when no dummy entries exist in
oratab.

**Root cause:** `mapfile` with empty array created phantom element  
**Solution:** Conditional sorting only when array has elements

### Installer Race Condition

Fixed intermittent "syntax error near unexpected token" during installation on
slow/busy systems.

**Solution:** Added `sync` command and 0.5s sleep after tar extraction

### PS1 Prompt

- Fixed empty PS1 prompt when using Oracle Homes
- Shows Oracle Home alias in prompt: `[rdbms26]`
- Removed invalid `local` keyword in oradba_standard.conf

## Upgrade Notes

### From v0.18.1

No breaking changes. Existing Oracle Home configurations will continue to work.
To benefit from lowercase aliases:

1. **For new Oracle Homes:** Aliases automatically created in lowercase
2. **For existing Oracle Homes:** Re-add with new alias or accept uppercase
   alias

**Reload shell configuration:**

```bash
source ~/.bash_profile
# or reconnect to shell
```

### Verification

After upgrade, verify Oracle Home aliases work:

```bash
# Check SIDLIST includes Oracle Homes
env | grep SIDLIST
ORADBA_SIDLIST=FREE DBHOMEFREE rdbms26

# Check aliases exist
alias | grep rdbms26
alias rdbms26='. /opt/oracle/local/oradba/bin/oraenv.sh DBHOMEFREE'

# Test alias
rdbms26  # Should switch to Oracle Home immediately
```

## Known Limitations

### SIDLIST Update After Add

When adding Oracle Homes with `oradba_homes.sh add`, SIDLIST is updated in the
subshell but not in the parent shell. Workaround: source any environment once
to refresh.

**Example:**

```bash
oradba_homes.sh add --name DBHOMEFREE --alias rdbms26
# SIDLIST not yet updated in current shell
. oraenv.sh FREE --silent  # Refresh once
# SIDLIST now updated with DBHOMEFREE and rdbms26
```

This is a shell limitation (subshell cannot modify parent environment) and has
minimal impact on usability.

## Files Changed

### Core Changes

- `src/lib/common.sh`: Alias resolution, config path fixes, SIDLIST generation
- `src/bin/oraenv.sh`: No changes (already supported alias resolution)
- `src/bin/oradba_homes.sh`: Lowercase default alias, regeneration calls
- `src/bin/oraup.sh`: Display alias name, array sorting fix
- `src/bin/oradba_install.sh`: Race condition fix
- `src/etc/oradba_standard.conf`: PS1 enhancement, local keyword fix

### Documentation

- `CHANGELOG.md`: Detailed v0.18.2 changes
- `doc/releases/v0.18.2.md`: This release documentation
- Archive structure maintained

## Testing

All existing tests pass:

- 42 Oracle Homes tests (BATS)
- 51 Service Management tests (BATS)
- Linting: Shell and Markdown

## Migration Path

### New Installations

Use lowercase conventions from the start:

```bash
oradba_homes.sh add \
  --name DBHOMEFREE \
  --alias rdbms26 \
  --path /opt/oracle/product/26ai/dbhomeFree \
  --desc "Oracle AI Database 26ai Free"

# Creates:
# - Lowercase alias: dbhomefree
# - Custom alias: rdbms26
```

### Existing Installations

If you have Oracle Homes registered with v0.18.1:

1. **Option 1: Keep existing aliases** (uppercase still works)
2. **Option 2: Re-register with new defaults:**

   ```bash
   oradba_homes.sh remove DBHOMEFREE
   oradba_homes.sh add --name DBHOMEFREE --alias rdbms26 ...
   ```

## Support

For issues or questions:

- GitHub Issues: <https://github.com/oehrlis/oradba/issues>
- Documentation: <https://oehrlis.github.io/oradba/>

## Contributors

- Stefan Oehrli (oes) - <stefan.oehrli@oradba.ch>

---

**Download:** [v0.18.2 Release](https://github.com/oehrlis/oradba/releases/tag/v0.18.2)  
**Previous Release:** [v0.18.1](v0.18.1.md)  
**Next Release:** TBD
